<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body>
  <div class="card">
    <h5 class="card-header">Login</h5>
    <div class="card-body">
      <h5 class="card-title">Please insert credentials</h5>
      <p class="card-text">Credentials require a username and password.</p>
<!--      <a href="#" class="btn btn-primary">Go somewhere</a>-->
      <div class="row">
        <div class="col-12">
          <form id="form">
            <div class="mb-3">
              <label for="username" class="form-label">User name</label>
              <input type="text" class="form-control" id="username" aria-describedby="emailHelp">
              <div id="emailHelp" class="form-text">We'll never share your email with anyone else.</div>
            </div>
            <div class="mb-3">
              <label for="password" class="form-label">Password</label>
              <input type="password" class="form-control" id="password">
            </div>
            <!--<div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="exampleCheck1">
              <label class="form-check-label" for="exampleCheck1">Check me out</label>
            </div>-->
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
        </div>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

  <script type="text/javascript">
    const username = document.getElementById("username")
    const password = document.getElementById("password")
    const form = document.getElementById("form")



    // Ejemplo implementando el metodo POST:
    async function postData(url = '', data = {}) {
      // Opciones por defecto estan marcadas con un *
      const response = await fetch(url, {
        method: 'POST', // *GET, POST, PUT, DELETE, etc.
        mode: 'cors', // no-cors, *cors, same-origin
        cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
        credentials: 'same-origin', // include, *same-origin, omit
        headers: {
          'Content-Type': 'application/json'
          // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        redirect: 'follow', // manual, *follow, error
        referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
        body: JSON.stringify(data) // body data type must match "Content-Type" header

      });
      return response.json(); // parses JSON response into native JavaScript objects
    }

    form.addEventListener("submit", function(evt) {
      evt.preventDefault()
      postData(
        'http://localhost:8080/jwt/user_lessor/authenticate',
        { username: username.value, password: password.value })
        .then(data => {
          console.log(data) // JSON data parsed by `data.json()` call
          localStorage.setItem('Auth-Token', `Bearer ${data.token}`)
          window.location.replace('http://localhost:8080/lessor_wsc.html');
        })
        .catch(e => {
          console.log("error")
          console.log(e)
        })
    })


  </script>
</body>
</html>